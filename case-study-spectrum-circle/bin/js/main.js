((function(){var a,b,c,d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){this.onSourceEnded=h(this.onSourceEnded,this),this.onBufferLoaded=h(this.onBufferLoaded,this),this.onFileDrop=h(this.onFileDrop,this),this.onRequestLoad=h(this.onRequestLoad,this),this.onRequestProgress=h(this.onRequestProgress,this)}return a.prototype.ctx=null,a.prototype.loaded=null,a.prototype.paused=!0,a.prototype.ended=null,a.prototype.startedAt=null,a.prototype.pausedAt=null,a.prototype.name=null,a.prototype.duration=null,a.prototype.currentTime=null,a.prototype.playbackRate=1,a.prototype.isDefaultFile=!1,a.prototype.sourceNode=null,a.prototype.analyserNode=null,a.prototype.buffer=null,a.prototype.values=null,a.prototype.FFT_SIZE=1024,a.prototype.BINS=256,a.EVENT_AUDIO_ENDED="audioEnded",a.EVENT_AUDIO_RESTARTED="audioRestarted",a.prototype.init=function(){return this.ctx=new AudioContext,this.values=[],this.duration=this.currentTime=0,this.analyserNode=this.ctx.createAnalyser(),this.analyserNode.smoothingTimeConstant=.6,this.analyserNode.fftSize=this.FFT_SIZE,this.analyserNode.connect(this.ctx.destination),this.load("sound/intro_colin.mp3")},a.prototype.update=function(){var a,b,c,d,e,f,g,h,i,j;if(this.ended)return;c=new Uint8Array(this.analyserNode.frequencyBinCount),this.analyserNode.getByteFrequencyData(c),f=c.length,b=Math.ceil(f/this.BINS);for(d=h=0,j=this.BINS;0<=j?h<j:h>j;d=0<=j?++h:--h){g=0;for(e=i=0;0<=b?i<b:i>b;e=0<=b?++i:--i)g+=c[d*b+e];a=g/b,this.values[d]=(a/256/this.playbackRate).toPrecision(2)/1}this.loaded&&!this.ended&&(this.currentTime=this.paused?this.pausedAt:Date.now()-this.startedAt,this.currentTime*=this.playbackRate)},a.prototype.load=function(a){var b;return b=new XMLHttpRequest,b.open("GET",a,!0),b.responseType="arraybuffer",b.onprogress=this.onRequestProgress,b.onload=this.onRequestLoad,b.send()},a.prototype.play=function(){return this.ended&&window.dispatchEvent(new Event(a.EVENT_AUDIO_RESTARTED)),this.sourceNode=this.ctx.createBufferSource(),this.sourceNode.onended=this.onSourceEnded,this.sourceNode.connect(this.analyserNode),this.sourceNode.playbackRate.value=this.playbackRate,this.sourceNode.buffer=this.buffer,this.ended=!1,this.paused=!1,this.pausedAt?(this.startedAt=Date.now()-this.pausedAt,this.sourceNode.start(0,this.pausedAt/1e3)):(this.startedAt=Date.now(),this.sourceNode.start(0))},a.prototype.stop=function(){if(!this.sourceNode)return;return this.sourceNode.stop(0),this.pausedAt=Date.now()-this.startedAt,this.paused=!0},a.prototype.seek=function(a){if(a===void 0)return;if(a>this.buffer.duration)return;this.ended=!1,this.paused||(this.sourceNode.onended=null,this.sourceNode.stop(0)),this.pausedAt=a*1e3;if(!this.paused)return this.play()},a.prototype.onRequestProgress=function(a){},a.prototype.onRequestLoad=function(a){this.isDefaultFile=!0,this.ctx.decodeAudioData(a.target.response,this.onBufferLoaded,this.onBufferError)},a.prototype.onFileDrop=function(a){this.buffer&&(this.sourceNode.stop(0),this.buffer=null),this.isDefaultFile=!1,this.ctx.decodeAudioData(a,this.onBufferLoaded,this.onBufferError),document.getElementById("feedback").innerText="decoding..."},a.prototype.onBufferLoaded=function(a){this.buffer=a,this.loaded=!0,this.duration=this.buffer.duration*1e3*this.playbackRate,this.play();if(this.name)return document.getElementById("feedback").innerText=this.name+" loaded"},a.prototype.onBufferError=function(a){},a.prototype.onSourceEnded=function(b){if(this.paused)return;return this.currentTime=this.duration,this.ended=!0,this.paused=!0,this.pausedAt=0,window.dispatchEvent(new Event(a.EVENT_AUDIO_ENDED))},a}(),d=function(){function a(a){this.ctx=a,this.view=app.view}return a.prototype.view=null,a.prototype.ctx=null,a.prototype.pos=null,a.prototype.values=null,a.prototype.iSelected=null,a.prototype.eSelected=null,a.prototype.update=function(a,b,c){this.values=a,this.iSelected=b!=null?b:-1,this.eSelected=c!=null?c:-1},a.prototype.draw=function(){var a,b,c,d,e,f,g;c=this.values.length,e=this.view.sketch.height,d=this.view.sketch.width/c-1,a=300,g=[];for(b=f=0;0<=c?f<c:f>c;b=0<=c?++f:--f)this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",b>=this.iSelected&&b<this.eSelected&&(this.ctx.fillStyle="rgba(124, 91, 35, 0.5)"),g.push(this.ctx.fillRect(b*(d+1),e,d,this.values[b]*-a-10));return g},a}(),b=function(){function a(){this.initBarChart=h(this.initBarChart,this),this.view=app.view,this.audio=app.audio,this.numSticks=150,this.stickSize=40,this.iniBin=30,this.endBin=this.iniBin+this.numSticks,this.initGUI(),this.initBarChart()}return a.prototype.view=null,a.prototype.audio=null,a.prototype.numSticks=null,a.prototype.stickSize=null,a.prototype.iniBin=null,a.prototype.endBin=null,a.prototype.mute=!1,a.prototype.drawBarChart=!1,a.prototype.initGUI=function(){var a,b,c,d;return c=new dat.GUI,c.open(),d=this,a=c.addFolder("Audio"),a.open(),a.add(this,"numSticks",0,360).step(1),a.add(this,"stickSize",0,200).step(1),a.add(this,"iniBin",0,this.audio.BINS).step(1),a.add(this,"endBin",0,this.audio.BINS).step(1),a.add(this,"mute").onChange(function(){return d.onMuteChange()}),b=c.addFolder("Debug"),b.open(),b.add(this,"drawBarChart")},a.prototype.initBarChart=function(){return this.barChart=new d(this.view.sketch)},a.prototype.onMuteChange=function(){return this.mute?this.audio.analyserNode.disconnect():this.audio.analyserNode.connect(this.audio.ctx.destination)},a.prototype.update=function(){this.barChart.update(this.audio.values,this.iniBin,this.endBin)},a.prototype.draw=function(){this.drawBarChart&&this.barChart.draw()},a}(),c=function(){function a(){this.initSpectrumCircles=h(this.initSpectrumCircles,this),this.initUI=h(this.initUI,this),this.initSketch=h(this.initSketch,this)}return a.prototype.audio=null,a.prototype.sketch=null,a.prototype.ui=null,a.prototype.down=!1,a.prototype.playbackFrame=null,a.prototype.circleRecord=null,a.prototype.init=function(){return this.audio=app.audio,this.initSketch()},a.prototype.initSketch=function(){var a=this;return this.sketch=Sketch.create({type:Sketch.CANVAS,container:document.getElementById("container"),retina:window.devicePixelRatio>=2}),this.sketch.setup=function(){return a.initUI(),a.initSpectrumCircles()},this.sketch.update=function(){var b;a.audio.update(),a.ui.update(),b=a.audio.values.slice(a.ui.iniBin,a.ui.endBin),a.circleRecord.update(b,a.ui.endBin-a.ui.iniBin),a.circleRecord.numSticks=a.ui.numSticks,a.circleRecord.stickSize=a.ui.stickSize},this.sketch.draw=function(){a.ui.draw(),a.sketch.save(),a.sketch.translate(a.sketch.width*.5,a.sketch.height*.4),a.circleRecord.draw(),a.sketch.restore()},this.sketch.resize=function(){},this.sketch.touchstart=function(){a.down=!0},this.sketch.touchmove=function(){if(!a.down)return},this.sketch.touchend=function(){a.down=!1},this.sketch.keyup=function(b){b.keyCode===32&&(a.audio.paused?a.audio.play():a.audio.stop())}},a.prototype.initUI=function(){this.ui=new b},a.prototype.initSpectrumCircles=function(){this.circleRecord=new f(this.sketch,"#fff")},a}(),f=function(){function a(a,b,c){this.ctx=a,this.color=b!=null?b:"#fff",this.radius=c!=null?c:200}return a.prototype.ctx=null,a.prototype.values=null,a.prototype.bins=null,a.prototype.radius=null,a.prototype.stickSize=null,a.prototype.numSticks=null,a.prototype.color=null,a.prototype.update=function(a,b){this.values=a,this.bins=b},a.prototype.draw=function(){var a,b,c,d,f,g,h,i,j,k;this.ctx.beginPath(),a=TWO_PI/this.numSticks;for(c=j=0,k=this.numSticks;0<=k?j<k:j>k;c=0<=k?++j:--j)f=e.map(c,0,this.numSticks,0,this.bins,!0),g=f<this.bins/2?this.values[f]:this.values[this.bins-f],g||(g=0),b=a*c-HALF_PI,d=this.stickSize*g+2,h=cos(b)*(this.radius-d),i=sin(b)*(this.radius-d),this.ctx.moveTo(h,i),h=cos(b)*(this.radius+d),i=sin(b)*(this.radius+d),this.ctx.lineTo(h,i);this.ctx.strokeStyle=this.color,this.ctx.stroke()},a}(),window.app={view:null,audio:null,init:function(){return app.initAudio(),app.initView(),app.audio.init(),app.view.init()},initAudio:function(){return app.audio=new a},initView:function(){return app.view=new c}},window.onload=function(){var a,b,c;if(window.FileReader)return a=function(a){return a.preventDefault&&a.preventDefault(),!1},c=function(a){var b,c,d,e,f,g,h;a.preventDefault&&a.preventDefault(),c=a.dataTransfer.files;for(d=g=0,h=c.length;0<=h?g<h:g>h;d=0<=h?++g:--g)b=c[d],f=new FileReader,e=b.type.indexOf("audio")===0,f.onloadend=function(a){return e?(app.audio.name=b.name,app.audio.onFileDrop(a.target.result)):console.log("not an audio file")},e&&f.readAsArrayBuffer(b);return!1},b=document.getElementById("container"),b.ondragover=a,b.ondragenter=a,b.ondrop=c},app.init(),e=function(){function a(){}return a.lerp=function(a,b,c){return a+(b-a)*c},a.interpolateCosine=function(a,b,c){var d;return d=(1-cos(c*Math.PI))/2,a*(1-d)+b*d},a.map=function(a,b,c,d,e,f,g,h){var i,j;return f==null&&(f=!1),g==null&&(g=!0),h==null&&(h=!0),g&&a<b?d:h&&a>c?e:(i=(a-b)/(c-b),j=i*(e-d)+d,f?Math.round(j):j)},a.hexToRgb=function(a){var b,c,d,e,f;return e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),e?(d=parseInt(e[1],16),c=parseInt(e[2],16),b=parseInt(e[3],16),f=d+", "+c+", "+b,{r:d,g:c,b:b,rgb:f}):null},a.rgbToHex=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},a}(),g=function(){function a(){}return a.addLeadingZero=function(a,b){var c,d,e;b==null&&(b=1),d=String(a);for(c=e=0;0<=b?e<b:e>b;c=0<=b?++e:--e)a<Math.pow(10,c+1)&&a>-1&&(d="0"+d);return d},a.formatTime=function(a,b,c,d,e){var f,g,h,i,j;return b==null&&(b=!0),c==null&&(c=!0),d==null&&(d=!0),e==null&&(e=!1),i=Math.floor(a/1e3),h=Math.floor(i/60),g=Math.floor(h/60),f=Math.floor(a%1e3),j="",b&&(j+=this.addLeadingZero(g)),b&&c&&(j+=":"),c&&(j+=this.addLeadingZero(h%60)),c&&d&&(j+=":"),d&&(j+=this.addLeadingZero(i%60)),d&&e&&(j+="."),e&&(j+=this.addLeadingZero(f,2).substr(0,2)),j},a}()})).call(this)